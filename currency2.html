<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>即時匯率計算器 (旗幟版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        /* Use Fira Code for mono elements */
        .font-mono {
            font-family: 'Fira Code', monospace;
        }
        /* Custom focus ring color */
        .focus\:ring-emerald-500:focus {
            --tw-ring-opacity: 1;
            --tw-ring-color: #10B981 !important; /* emerald-500 */
        }
        /* Blinking cursor effect */
        .blinking-cursor {
            border-right: 2px solid #10B981;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { border-color: transparent }
            50% { border-color: #10B981; }
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto max-w-lg p-4 sm:p-6">
        <main class="bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl shadow-emerald-900/20 border border-gray-700 overflow-hidden">
            
            <!-- Window Title Bar -->
            <div class="h-10 bg-gray-900/80 flex items-center px-4 border-b border-gray-700">
                <div class="flex space-x-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <p class="text-center text-gray-400 text-sm flex-grow font-mono">fx_rate_converter</p>
            </div>

            <!-- Header Section with Input -->
            <div class="text-center p-6 border-b border-gray-700">
                <label for="base-amount-input" class="text-sm text-emerald-400 mb-2 block tracking-wider">兌換金額成港幣HKD</label>
                <div class="relative inline-block">
                    <input type="number" id="base-amount-input" value="100" class="text-4xl font-semibold text-white tracking-tighter text-center w-full bg-transparent focus:outline-none focus:ring-0 border-none p-0 font-mono">
                    <span class="blinking-cursor absolute top-0 right-[-10px] h-full"></span>
                </div>
            </div>

            <!-- Currency List (Single Column) -->
            <div id="currency-list" class="grid grid-cols-1 gap-3 p-6">
                <!-- Loading State -->
                <p class="col-span-1 text-center text-gray-500 font-mono">Initializing...</p>
            </div>

            <!-- Separator -->
            <div class="border-t border-gray-700"></div>

            <!-- Global Converter Section -->
            <div class="p-6 bg-gray-900/50">
                <h3 class="text-center font-bold text-emerald-400 mb-4 tracking-wider">全球貨幣轉換</h3>
                <div class="grid grid-cols-1 gap-4">
                    <input type="number" id="global-amount" value="100" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white font-mono">
                    <div class="flex items-center gap-3">
                        <select id="from-currency" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white font-mono"></select>
                        <span class="text-emerald-400">→</span>
                        <select id="to-currency" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-md focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none text-white font-mono"></select>
                    </div>
                    <div id="global-result-container" class="text-right p-3 bg-gray-800 rounded-md border border-gray-700" style="display: none;">
                        <p id="global-result" class="text-xl font-semibold text-white font-mono"></p>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-6">
            <p id="timestamp" class="text-xs text-gray-500 font-mono"></p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const apiKey = 'fxr_live_38ad3c55b228cc844e71347bdb45cb3c63df';
            
            const currencyInfo = {
                USD: { name: '美元', engName: 'US Dollar', code: 'us', emoji: '🇺🇸' },
                EUR: { name: '歐元', engName: 'Euro', code: 'eu', emoji: '🇪🇺' },
                JPY: { name: '日元', engName: 'Japanese Yen', code: 'jp', emoji: '🇯🇵' },
                GBP: { name: '英鎊', engName: 'British Pound', code: 'gb', emoji: '🇬🇧' },
                CNY: { name: '人民幣', engName: 'Chinese Yuan', code: 'cn', emoji: '🇨🇳' },
                AUD: { name: '澳元', engName: 'Australian Dollar', code: 'au', emoji: '🇦🇺' },
                CAD: { name: '加拿大元', engName: 'Canadian Dollar', code: 'ca', emoji: '🇨🇦' },
                CHF: { name: '瑞士法郎', engName: 'Swiss Franc', code: 'ch', emoji: '🇨🇭' },
                HKD: { name: '港幣', engName: 'Hong Kong Dollar', code: 'hk', emoji: '🇭🇰' },
                SGD: { name: '新加坡元', engName: 'Singapore Dollar', code: 'sg', emoji: '🇸🇬' },
                SEK: { name: '瑞典克朗', engName: 'Swedish Krona', code: 'se', emoji: '🇸🇪' },
                KRW: { name: '韓元', engName: 'South Korean Won', code: 'kr', emoji: '🇰🇷' },
                NOK: { name: '挪威克朗', engName: 'Norwegian Krone', code: 'no', emoji: '🇳🇴' },
                NZD: { name: '紐西蘭元', engName: 'New Zealand Dollar', code: 'nz', emoji: '🇳🇿' },
                INR: { name: '印度盧比', engName: 'Indian Rupee', code: 'in', emoji: '🇮🇳' },
                MXN: { name: '墨西哥比索', engName: 'Mexican Peso', code: 'mx', emoji: '🇲🇽' },
                TWD: { name: '新台幣', engName: 'New Taiwan Dollar', code: 'tw', emoji: '🇹🇼' },
                ZAR: { name: '南非蘭特', engName: 'South African Rand', code: 'za', emoji: '🇿🇦' },
                BRL: { name: '巴西雷亞爾', engName: 'Brazilian Real', code: 'br', emoji: '🇧🇷' },
                TRY: { name: '土耳其里拉', engName: 'Turkish Lira', code: 'tr', emoji: '🇹🇷' },
                NGN: { name: '奈及利亞奈拉', engName: 'Nigerian Naira', code: 'ng', emoji: '🇳🇬' },
                THB: { name: '泰銖', engName: 'Thai Baht', code: 'th', emoji: '🇹🇭' },
                PHP: { name: '菲律賓比索', engName: 'Philippine Peso', code: 'ph', emoji: '🇵🇭' },
                VND: { name: '越南盾', engName: 'Vietnamese Dong', code: 'vn', emoji: '🇻🇳' },
                IDR: { name: '印尼盾', engName: 'Indonesian Rupiah', code: 'id', emoji: '🇮🇩' },
                MYR: { name: '馬來西亞令吉', engName: 'Malaysian Ringgit', code: 'my', emoji: '🇲🇾' },
                RUB: { name: '俄羅斯盧布', engName: 'Russian Ruble', code: 'ru', emoji: '🇷🇺' }
            };

            const topSectionCodes = ['USD', 'JPY', 'TRY', 'EUR', 'CNY', 'TWD', 'INR', 'GBP', 'AUD', 'CAD', 'SGD', 'KRW', 'NGN', 'HKD'];
            const allNeededCodes = [...new Set([...topSectionCodes, ...Object.keys(currencyInfo)])];
            const apiUrl = `https://api.fxratesapi.com/latest?api_key=${apiKey}&base=USD&currencies=${allNeededCodes.join(',')}`;
            
            const listElement = document.getElementById('currency-list');
            const amountInput = document.getElementById('base-amount-input');
            const timestampEl = document.getElementById('timestamp');

            const globalAmountInput = document.getElementById('global-amount');
            const fromCurrencySelect = document.getElementById('from-currency');
            const toCurrencySelect = document.getElementById('to-currency');
            const globalResultEl = document.getElementById('global-result');
            const globalResultContainer = document.getElementById('global-result-container');

            async function fetchRates() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                    const data = await response.json();
                    if (!data.success) throw new Error(data.error?.info || 'API Error');
                    
                    const updateTime = new Date(data.timestamp * 1000);
                    timestampEl.textContent = `[RATES_UPDATED]: ${updateTime.toISOString()}`;
                    
                    return data.rates;
                } catch (error) {
                    console.error('Fetch Rates Error:', error);
                    listElement.innerHTML = `<p class="col-span-1 text-center text-red-500 font-mono">Error: Failed to load live rates.</p>`;
                    timestampEl.textContent = '[ERROR]: CONNECTION_FAILED';
                    return null;
                }
            }

            const ratesVsUsd = await fetchRates();

            if (ratesVsUsd) {
                const hkdPerUsd = ratesVsUsd['HKD'];
                const ratesVsHkd = {};
                for (const code in ratesVsUsd) {
                    ratesVsHkd[code] = ratesVsUsd[code] / hkdPerUsd;
                }

                setupTopCalculator(ratesVsHkd);
                setupGlobalConverter(ratesVsUsd);
            }

            function setupTopCalculator(rates) {
                const ratesInHkd = {};
                for (const code in rates) { ratesInHkd[code] = 1 / rates[code]; }
                ratesInHkd['HKD'] = 1;

                const priorityCodes = ['HKD', 'USD', 'JPY', 'CNY'];
                const otherCodes = topSectionCodes.filter(code => !priorityCodes.includes(code)).sort();
                const sortedCodes = [...priorityCodes, ...otherCodes];

                function updateList() {
                    const currentAmount = parseFloat(amountInput.value) || 0;
                    listElement.innerHTML = ''; 

                    sortedCodes.forEach(code => {
                        const value = (ratesInHkd[code] || 0) * currentAmount;
                        const info = currencyInfo[code];
                        if (!info) return;

                        const item = document.createElement('div');
                        const isPriority = priorityCodes.includes(code);
                        item.className = `flex items-center space-x-4 p-3 rounded-lg bg-gray-900/50 border ${isPriority ? 'border-emerald-500/30' : 'border-blue-500/20'}`;
                        
                        const flagUrl = `https://flagcdn.com/w40/${info.code}.png`;

                        item.innerHTML = `
                            <img src="${flagUrl}" alt="${info.name}" class="w-9 h-9 object-cover rounded-full shadow-lg flex-shrink-0">
                            <div class="flex-grow text-left overflow-hidden">
                                <p class="font-semibold truncate ${isPriority ? 'text-emerald-400' : 'text-blue-400'}">
                                    <span class="font-mono">${code}</span>
                                    <span class="text-xs text-gray-400">${info.name}</span>
                                </p>
                                <p class="text-xs text-gray-500 truncate">${info.engName}</p>
                            </div>
                            <p class="text-xl font-semibold text-white font-mono">
                                ${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                            </p>
                        `;
                        listElement.appendChild(item);
                    });
                }
                amountInput.addEventListener('input', updateList);
                updateList();
            }

            function setupGlobalConverter(rates) {
                const currencyCodes = Object.keys(currencyInfo).sort();

                currencyCodes.forEach(code => {
                    const info = currencyInfo[code];
                    if (rates[code] && info) {
                        const optionText = `${info.emoji} ${code} - ${info.name} / ${info.engName}`;
                        fromCurrencySelect.add(new Option(optionText, code));
                        toCurrencySelect.add(new Option(optionText, code));
                    }
                });

                fromCurrencySelect.value = 'USD';
                toCurrencySelect.value = 'HKD';

                function convertGlobal() {
                    const amount = parseFloat(globalAmountInput.value);
                    const fromCode = fromCurrencySelect.value;
                    const toCode = toCurrencySelect.value;

                    if (isNaN(amount)) {
                        globalResultEl.textContent = 'Invalid Amount'; return;
                    }

                    const fromRate = rates[fromCode];
                    const toRate = rates[toCode];
                    const result = (amount / fromRate) * toRate;

                    globalResultEl.innerHTML = `
                        ${result.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4})} 
                        <span class="text-gray-500">${toCode}</span>`;
                    globalResultContainer.style.display = 'block';
                }

                globalAmountInput.addEventListener('input', convertGlobal);
                fromCurrencySelect.addEventListener('change', convertGlobal);
                toCurrencySelect.addEventListener('change', convertGlobal);
                convertGlobal();
            }
        });
    </script>
</body>
</html>


