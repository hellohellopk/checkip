<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Info</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
            background: #1e1e1e;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #00ff00;
        }
        .terminal {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        .titlebar {
            background: #2d2d2d;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27c93f; }
        .title {
            flex: 1;
            text-align: center;
            color: #999;
            font-size: 13px;
        }
        .content {
            padding: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        .prompt { color: #00ff00; }
        .command { color: #00d4ff; }
        .output { color: #d4d4d4; margin-left: 20px; }
        .label { color: #ffbd2e; }
        .value { color: #00ff00; }
        #map {
            width: 100%;
            height: 300px;
            margin: 15px 0;
            border-radius: 6px;
            background: #0a0a0a;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div class="terminal">
        <div class="titlebar">
            <div class="dot red"></div>
            <div class="dot yellow"></div>
            <div class="dot green"></div>
            <div class="title">network-info — bash</div>
        </div>
        <div class="content">
            <div><span class="prompt">user@macbook ~ %</span> <span class="command">./network-info.sh</span></div>
            <div id="loading" style="margin: 20px 0;">
                <div class="output">Fetching network information<span class="blink">_</span></div>
            </div>
            <div id="results" style="display:none;">
                <div class="output">
                    <div><span class="label">Public IP:</span> <span class="value" id="ip"></span></div>
                    <div><span class="label">Country:</span> <span class="value" id="country"></span></div>
                    <div><span class="label">ISP:</span> <span class="value" id="isp"></span></div>
                    <div><span class="label">DNS:</span> <span class="value" id="dns"></span></div>
                    <div><span class="label">DNS PTR:</span> <span class="value" id="dnsptr"></span></div>
                    <div><span class="label">Location:</span> <span class="value" id="location"></span></div>
                </div>
                <div id="map"></div>
                <div class="output" style="margin-top: 15px;">
                    <div><span class="label">Ping Tests:</span></div>
                    <div style="margin-left: 20px;" id="pings">Testing<span class="blink">_</span></div>
                </div>
                <div><span class="prompt">user@macbook ~ %</span> <span class="blink">_</span></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const countryMap = {
            "US": "United States 美國", "GB": "United Kingdom 英國", "CA": "Canada 加拿大",
            "AU": "Australia 澳洲", "DE": "Germany 德國", "FR": "France 法國",
            "JP": "Japan 日本", "CN": "China 中國", "IN": "India 印度",
            "HK": "Hong Kong 香港", "TW": "Taiwan 台灣", "SG": "Singapore 新加坡",
            "KR": "South Korea 南韓", "IT": "Italy 意大利", "ES": "Spain 西班牙",
            "NL": "Netherlands 荷蘭", "SE": "Sweden 瑞典", "CH": "Switzerland 瑞士"
        };

        async function getIPInfo() {
            try {
                const r = await fetch('https://ipinfo.io/json');
                const j = await r.json();
                return {
                    ip: j.ip || 'Unavailable',
                    country: j.country || 'Unknown',
                    org: j.org || 'Unknown ISP',
                    city: j.city || '',
                    region: j.region || '',
                    loc: j.loc || null
                };
            } catch {
                return {ip: 'Unavailable', country: 'Unknown', org: 'Unknown ISP', city: '', region: '', loc: null};
            }
        }

        async function getDNSInfo() {
            try {
                const r = await fetch('https://edns.ip-api.com/json');
                const j = await r.json();
                const ip = j.dns?.ip;
                
                if (!ip) return { ip: null, ptr: null };
                
                const reversed = ip.split('.').reverse().join('.') + '.in-addr.arpa';
                const ptrRes = await fetch(`https://dns.google/resolve?name=${reversed}&type=PTR`);
                const ptrData = await ptrRes.json();
                
                return {
                    ip: ip,
                    ptr: ptrData.Answer?.[0]?.data?.replace(/\.$/, '') || 'No PTR record'
                };
            } catch {
                return { ip: null, ptr: null };
            }
        }

        async function main() {
            const [ipInfo, dnsInfo] = await Promise.all([getIPInfo(), getDNSInfo()]);

            document.getElementById('ip').textContent = ipInfo.ip;
            document.getElementById('country').textContent = countryMap[ipInfo.country] || ipInfo.country;
            document.getElementById('isp').textContent = ipInfo.org;
            document.getElementById('dns').textContent = dnsInfo.ip || 'System Default';
            document.getElementById('dnsptr').textContent = dnsInfo.ptr || 'N/A';
            
            const locParts = [ipInfo.city, ipInfo.region].filter(x => x);
            document.getElementById('location').textContent = locParts.join(', ') || 'Unknown';
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';

            if (ipInfo.loc) {
                const [lat, lon] = ipInfo.loc.split(',').map(Number);
                const map = L.map('map').setView([lat, lon], 10);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '© OpenStreetMap'
                }).addTo(map);
                L.marker([lat, lon]).addTo(map).bindPopup(`${ipInfo.ip}<br>${locParts.join(', ')}`).openPopup();
            }

            // Ping tests
            const hosts = [
                ['Google', 'https://www.google.com/favicon.ico'],
                ['Cloudflare', 'https://www.cloudflare.com/favicon.ico'],
                ['AWS', 'https://aws.amazon.com/favicon.ico']
            ];

            let pings = '';
            for (const [name, url] of hosts) {
                const t = Date.now();
                try {
                    await fetch(url, {mode: 'no-cors'});
                    const ping = Date.now() - t;
                    pings += `<div>${name}: <span class="value">${ping}ms</span></div>`;
                } catch {
                    pings += `<div>${name}: <span style="color:#ff5f56">Failed</span></div>`;
                }
            }
            document.getElementById('pings').innerHTML = pings;
        }

        main();
    </script>
</body>
</html>
